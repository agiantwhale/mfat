"use strict";$(document).ready(function(){var e=$("#meal").selectize({highlight:!1,openOnFocus:!0});e[0].selectize.setValue("LUNCH");var t=$("#location").selectize({highlight:!1,openOnFocus:!0}),n=$("#goal").selectize({highlight:!1,openOnFocus:!0,onChange:function(e){"calories"===e&&$("#counterpart").html("portions"),"portion"===e&&$("#counterpart").html("calories")}}),i=$("#repeats").selectize({highlight:!1,openOnFocus:!0}),r=$("#portion").html();$("#portion").blur(function(){r!==$(this).html()&&(r=$(this).html().replace(/\D/g,""),""===r&&(r="0"),$(this).html(r))}),$("#return-btn").click(function(){$("#query").removeClass("hidden"),$("#table").addClass("hidden")}),$("#plan-btn").click(function(){swal({title:"One second...",text:"Loading latest dining hall menu...",type:"info",allowEscapeKey:!1,showConfirmButton:!1});var o=e[0].selectize.getValue(),l=t[0].selectize.getValue(),a=n[0].selectize.getValue(),s="calories"===a?"portion":"calories",c="yes"===i[0].selectize.getValue();MFat.scrap(l).then(function(e){if(!_.isArray(e[o]))return void swal({title:"Oops..",text:"Seems like "+l+" isn't serving "+o.toLowerCase()+" today!",type:"error",confirmButtonText:"Alright..."});MFat.collection(e[o],s,a,c);var t=MFat.optimize(parseInt(r)),n=_.reduce(t.collection,function(e,t){return e+t.calories},0),i=_.reduce(t.collection,function(e,t){return e+t.portion},0),u="";_.each(t.collection,function(e){u+="<tr>",u+="<td>"+e.name+"</td>",u+="<td>"+e.calories+"</td>",u+="<td>"+e.portion+"</td>",u+="</tr>"}),u+="<tr>",u+="<td>Total</td>",u+="<td>"+n+"</td>",u+="<td>"+i+"</td>",u+="</tr>",$("#table-body").html(u),$("#query").addClass("hidden"),$("#table").removeClass("hidden"),swal.close()}).fail(function(){swal({title:"Oops..",text:"There was an error retrieving the latest menu information. Give Jae a message!",type:"error",confirmButtonText:"Alright..."})})})}),this.MFat=function(e,t){var n=!1,i=[],r="",o="",l={},a=[],s=function(e,n){var o={};o[r]=e;var l=t.sortedIndex(i,o,r);return l<i.length&&i[l][r]===e&&l++,Math.min(l,n)},c=function(e,t){return 0>e?-1:e>=t?e*e+e+t:e+t*t},u=function(e,u){var h=s(e,u);if(0>=h||0>e)return l[c(e,u)]={collection:[],accumulator:0},!0;if(!t.isUndefined(l[c(e,h)]))return l[c(e,u)]=l[c(e,h)],!0;var m=l[c(e,h-1)];if(t.isUndefined(m))return a.push([e,h-1]),!1;var p=i[h-1],d=l[c(e-p[r],n?h:h-1)];return t.isUndefined(d)?(a.push([e-p[r],n?h:h-1]),!1):(d={collection:d.collection.slice(0),accumulator:d.accumulator},d.collection.push(p),d.accumulator+=p[o],d.accumulator>m.accumulator?l[c(e,u)]=d:l[c(e,u)]=m,!0)};return e.optimize=function(e){var n=s(e,i.length);for(a.push([e,n]);0!==a.length;)u.apply(null,t.last(a))&&(a=t.initial(a));return l[c(e,n)]},e.collection=function(e,s,c,u){l={},a=[],r=s,o=c,n=u,i=t.sortBy(e,r)},e}(this.MFat||{},_),this.MFat=function(e,t){var n=function(e){var n={};for(var i in e.menu.meal){var r=e.menu.meal[i],o=r.name,l=[];for(var a in r.course){var s=r.course[a];if(t.isArray(s.menuitem)){var c=null,u=null,h=null,m=null;for(var p in s.menuitem){c=s.menuitem[p];try{u=c.name,h=parseInt(c.itemsize.portion_size),m=c.itemsize.nutrition.kcal,m=parseInt(m.substring(0,m.length-4)),l.push({name:u,portion:h,calories:m})}catch(d){console.log(d)}}}else if(t.isPlainObject(s.menuitem)){c=s.menuitem;try{u=c.name,h=parseInt(c.itemsize.portion_size),m=c.itemsize.nutrition.kcal,m=parseInt(m.substring(0,m.length-4)),l.push({name:u,portion:h,calories:m})}catch(d){console.log(d)}}}n[o]=l}for(var f in n)0===n[f].length&&delete n[f];return n};return e.scrap=function(e){var i=new t.Deferred,r="https://query.yahooapis.com/v1/public/yql",o="http://api.studentlife.umich.edu/menu/xml2print.php?controller=print&view=json&location="+encodeURI(e);return t.ajax({url:r,data:{q:'SELECT * FROM json WHERE url="'+o+'"',format:"json",jsonCompat:"new"},dataType:"jsonp",success:function(e){e=e.query.results.json;var t=n(e);i.resolve(t)},error:function(){i.reject()}}),i.promise()},e}(this.MFat||{},jQuery);