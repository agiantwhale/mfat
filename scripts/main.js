"use strict";$(document).ready(function(){var e=$("#meal").selectize({highlight:!1,openOnFocus:!0});e[0].selectize.setValue("LUNCH");var t=$("#location").selectize({highlight:!1,openOnFocus:!0}),n=$("#goal").selectize({highlight:!1,openOnFocus:!0,onChange:function(e){"calories"===e&&$("#counterpart").html("(g) servings"),"portion"===e&&$("#counterpart").html("(kcal) calories")}}),r=$("#repeats").selectize({highlight:!1,openOnFocus:!0}),i=$("#portion").html();$("#portion").blur(function(){i!==$(this).html()&&(i=$(this).html().replace(/\D/g,""),""===i&&(i="0"),$(this).html(i))}),$("#return-btn").click(function(){$("#query").removeClass("hidden"),$("#table").addClass("hidden")}),$("#plan-btn").click(function(){swal({title:"One second...",text:"Loading latest dining hall menu...",type:"info",allowEscapeKey:!1,showConfirmButton:!1});var o=e[0].selectize.getValue(),l=t[0].selectize.getValue(),a=n[0].selectize.getValue(),c="calories"===a?"portion":"calories",s="yes"===r[0].selectize.getValue();MFat.scrap(l).then(function(e){if(!_.isArray(e[o]))return void swal({title:"Oops..",text:"Seems like "+l+" isn't serving "+o.toLowerCase()+" today!",type:"error",confirmButtonText:"Alright..."});MFat.collection(e[o],c,a,s);var t=MFat.optimize(parseInt(i)),n=_.reduce(t.collection,function(e,t){return e+t.calories},0),r=_.reduce(t.collection,function(e,t){return e+t.portion},0),u="";_.each(t.collection,function(e){u+="<tr>",u+="<td>"+e.name+"</td>",u+="<td>"+e.calories+" kcal</td>",u+="<td>"+e.serving+" ("+e.portion+" g)</td>",u+="</tr>"}),u+="<tr>",u+="<td>Total</td>",u+="<td>"+n+" kcal</td>",u+="<td>"+r+" g</td>",u+="</tr>",$("#table-body").html(u),$("#query").addClass("hidden"),$("#table").removeClass("hidden"),swal.close()}).fail(function(){swal({title:"Oops..",text:"There was an error retrieving the latest menu information. Give Jae a message!",type:"error",confirmButtonText:"Alright..."})})})}),this.MFat=function(e,t){var n=!1,r=[],i="",o="",l={},a=[],c=function(e,n){var o={};o[i]=e;var l=t.sortedIndex(r,o,i);return l<r.length&&r[l][i]===e&&l++,Math.min(l,n)},s=function(e,t){return 0>e?-1:e>=t?e*e+e+t:e+t*t},u=function(e,u){var h=c(e,u);if(0>=h||0>e)return l[s(e,u)]={collection:[],accumulator:0},!0;if(!t.isUndefined(l[s(e,h)]))return l[s(e,u)]=l[s(e,h)],!0;var m=l[s(e,h-1)];if(t.isUndefined(m))return a.push([e,h-1]),!1;var p=r[h-1],d=l[s(e-p[i],n?h:h-1)];return t.isUndefined(d)?(a.push([e-p[i],n?h:h-1]),!1):(d={collection:d.collection.slice(0),accumulator:d.accumulator},d.collection.push(p),d.accumulator+=p[o],d.accumulator>m.accumulator?l[s(e,u)]=d:l[s(e,u)]=m,!0)};return e.optimize=function(e){var n=c(e,r.length);for(a.push([e,n]);0!==a.length;)u.apply(null,t.last(a))&&(a=t.initial(a));return l[s(e,n)]},e.collection=function(e,c,s,u){l={},a=[],i=c,o=s,n=u,r=t.sortBy(e,i)},e}(this.MFat||{},_),this.MFat=function(e,t){var n=function(e){try{var t=e.name,n=parseInt(e.itemsize.portion_size),r=e.itemsize.serving_size,i=e.itemsize.nutrition.kcal;return i=parseInt(i.substring(0,i.length-4)),{name:t,portion:n,serving:r,calories:i}}catch(o){console.log(o)}return null},r=function(e){var r={};for(var i in e.menu.meal){var o=e.menu.meal[i],l=o.name,a=[];for(var c in o.course){var s=o.course[c],u=null,h=null;if(t.isArray(s.menuitem))for(var m in s.menuitem)u=s.menuitem[m],h=n(u),h&&a.push(h);else t.isPlainObject(s.menuitem)&&(u=s.menuitem,h=n(u),h&&a.push(h))}r[l]=a}for(var p in r)0===r[p].length&&delete r[p];return r};return e.scrap=function(e){var n=new t.Deferred,i="https://query.yahooapis.com/v1/public/yql",o="http://api.studentlife.umich.edu/menu/xml2print.php?controller=print&view=json&location="+encodeURI(e);return t.ajax({url:i,data:{q:'SELECT * FROM json WHERE url="'+o+'"',format:"json",jsonCompat:"new"},dataType:"jsonp",success:function(e){e=e.query.results.json;var t=r(e);n.resolve(t)},error:function(){n.reject()}}),n.promise()},e}(this.MFat||{},jQuery);